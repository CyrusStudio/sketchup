
---

# 📜 SketchUp extension 參數化櫃體系統：完整設計決策全紀錄

## 第一階段：從腳本到系統架構 (Architecture)

### 1. 核心轉折：Script vs. System

* **初始想法：** 寫一個 Ruby 腳本，輸入 W, D, H 就畫出一個櫃子。
* **遇到問題：** 如果櫃型變多（L型、高櫃、電視櫃），程式碼會變得無法維護。
* **關鍵決策：** 採用**「數據驅動 (Data-Driven)」**架構。
* **Ruby 角色轉變：** Ruby 不再知道自己在畫什麼，它變成一個「通用引擎 (Universal Engine)」。
* **規則定義：** 所有的櫃子規則（扣板厚、內縮、門縫）全部移出程式碼，存入 **JSON Schema**。



### 2. 資料結構 (The DNA)

* 我們定義了櫃子的 DNA 必須包含 `meta` (身分), `params` (變數), `parts` (零件)。
* **公式化：** JSON 內的數值不寫死，而是儲存字串公式，例如 `"width": "W - 2*T"`。

---

## 第二階段：幾何與構造邏輯 (Construction Logic)

### 1. 基礎櫃體規則

* **範例定義：** 18mm 側板、18mm 頂底板、8mm 背板。
* **結構邏輯：** 側板包底板 (Side encloses Bottom)。
* **五金邏輯 (Hardware Rules)：**
* 深度 <= 600mm：配 4 顆五金。
* 深度 > 600mm：配 6 顆五金。
* **實作：** 支援三元運算子 `Depth > 600 ? 6 : 4` 寫在 JSON 或 Ruby 邏輯中。



### 2. 背板與溝槽的「視覺詐欺」策略 (Visual Fraud)

* **技術難點：** 為了 8mm 背板去執行 Boolean (布林運算) 挖溝非常耗效能，且容易破面。
* **關鍵決策：不做實體挖槽，只做視覺穿插。**
* **模型表現：** 背板直接「插入」側板內部 (Overlap)。渲染與視覺上看來是完美的。
* **報價數據：** 在 JSON 公式中，背板寬度 = `內徑 + (溝深 * 2)`。這樣算出來的板材面積（才數）是精準的。
* **生產端：** 因為不輸出 CNC 碼 (No CAM)，所以模型內有沒有真的挖洞不重要。



---

## 第三階段：材質與紋理系統 (Material & UV)

### 1. 紋理方向難題 

* **問題：** 程式很難自動判斷使用者想要直紋還是橫紋，也不容易判斷板材長邊。
* **解決方案：約定優於配置 (Convention over Configuration)。**
* **黃金規則：** 規定所有匯入系統的材質圖檔，原始紋理必須是 **橫向 (Horizontal)**。
* **控制權：** 在 JSON 的 `parts` 裡定義 `grain: "vertical"` 或 `"horizontal"`。
* **程式邏輯：** * 若 JSON 寫 `horizontal` -> 直接貼圖 (因為原始圖就是橫的)。
* 若 JSON 寫 `vertical` -> 程式自動旋轉 UV 90 度。





### 2. 材質更換架構

* **問題：** 如何快速把所有門片換色？
* **決策：** 使用**「插槽 (Slots)」**概念。
* 零件不綁定材質名稱（如 `Oak_Wood`），而是綁定角色（如 `Role: Door`, `Role: Body`）。
* 使用者在 UI 更改 `Role: Door` 的對應材質時，全場景的門片會同步更新。



---

## 第四階段：特殊櫃型與擴充性 (Special Cabinets)

### 1. 轉角櫃與封板

* **封板 (Filler)：**
* 視為標準矩形櫃的變形。
* 透過參數 `filler_width` 調整門片寬度公式 `(W - filler) / 2`。
* 視覺上增加一塊封板幾何體。


* **L型/切角櫃 (L-Shape)：**
* **原理：** 無法用 W, D 描述。需改用 `points` (多邊形頂點) 描述底面。
* **生成邏輯：** 採用 **2D 路徑擠出 (Profile Extrusion)**。沿著底面的邊長出側板。
* **開發決策：** 原理可行，但數學複雜度高。**在 MVP 階段暫緩開發，優先完善矩形櫃系統。**



### 2. 開發者的「想像力」

* **結論：** 開發者必須具備將實體櫃子「抽象化」為 JSON 座標與公式的能力。
* **未來擴充：** 未來可開發「畫圖轉 JSON」的工具，讓使用者畫一個平面，程式自動產生 DNA，降低手寫 JSON 的門檻。

---

## 第五階段：互動配置體驗 (UX & Placement)

### 1. 放置工具 (Placement Tool)

* **幽靈預覽 (Ghost)：** 滑鼠移動時，顯示半透明線框。
* **智慧吸附 (Smart Snapping)：**
* **牆面：** 偵測 Face Normal，自動旋轉櫃背貼牆。
* **鄰居：** 偵測鄰近 Component，自動吸附對齊。



### 2. 操作模式

* **蓋章模式 (Stamp)：** 放下固定尺寸的櫃子。
* **拖曳填充 (Drag-to-Fill)：** 點擊兩點，程式自動計算 `W` 並生成櫃子（這是參數化最強大的應用）。

---

## 第六階段：報價與數據 (Quotation & BOM)

### 1. 報價策略

* **計價分離：** SketchUp 只算「數量」，價格由外部 `CSV/JSON` 表格提供。
* **計算邏輯：**
* 板材：計算 `width * height` (需含損耗係數)。
* 五金：統計組件數量。


* **再編輯機制 (Re-edit)：**
* 櫃子生成時，將當時的 JSON 參數寫入 `AttributeDictionary`。
* 修改時讀取這些屬性，回填 UI，確保修改後的櫃子仍保有參數化特性。

